"""
This file is used to determine what model should be used for inference.
Early stopping is a form of regularization used to avoid overfitting.

Ideally this would be integrated into the training loop itself. However,
having already trained models I needed a way to select which model to use afterwards.
Either way, this achieves the same effect.
"""

patch_7c = [15.07676888, 7.14147806, 8.12860584, 6.03093672, 6.65428829, 6.26486111, 4.89569569, 3.74221492, 4.24098587, 4.47238445, 4.28701687, 4.14174414, 5.33335638, 4.43928814, 3.65916204, 4.13962841, 4.74225521, 3.60446215, 5.66396093, 5.21688175, 3.53813434, 5.2081461, 4.00005245, 5.116189, 4.05465889, 4.61948538, 3.33198428, 3.10306501, 3.56895781, 4.14136934, 3.3546834, 4.05378103, 4.04373026, 3.88673401, 3.42973781, 3.5652535, 3.99743843, 3.6999557, 4.36909103, 3.72004843, 3.85089564, 3.84897494, 3.55333471, 3.62489367, 3.57025719, 3.50854254, 3.6488235, 3.638237, 3.40710831, 3.35936213, 3.24712229, 3.14984465, 3.33240056, 3.73977041, 3.19849443, 3.59809875, 3.08032894, 3.26908541, 3.40250707, 3.47893214, 3.40702963, 4.09178638, 3.27904272, 3.76648712, 3.76158977, 3.64738846, 3.39888692, 3.79847956, 3.21028137, 3.79010534, 3.15402675, 3.2176919, 3.22948337, 3.64154291, 3.42094111, 3.28860426, 3.30246854, 3.21497583, 3.20194769, 3.6241889, 3.26649475, 3.56988096, 3.0587275, 3.41402006, 3.42100024, 3.06916904, 4.09404659, 3.4853816, 3.0883193, 3.19640493, 3.79550242, 3.11954236, 3.09675884, 3.23691821, 3.23369479, 3.28774142, 3.19222784, 3.14159393, 3.48503423, 2.99682879, 3.82516217, 3.28336668, 3.36317635, 3.17420101, 3.13791895, 3.04517484, 3.25491977, 3.32685733, 3.27291346, 3.26348686, 3.44652748, 3.55581999, 2.98105502, 3.10857344, 3.35151148, 3.13867784, 3.11188936, 3.02548075, 3.38346982, 3.08938551, 3.47847676, 3.05822158, 3.04696727, 3.1845746, 3.08257651, 3.3319695]
patch_5c = [13.9262104, 10.67207623, 5.83664942, 9.59089184, 3.76527405, 5.56882906, 3.96271372, 8.67961979, 5.25253963, 5.06001043, 5.18571997, 4.22895098, 4.93679571, 3.98937035, 5.19859314, 3.96118617, 3.54038763, 5.41351986, 5.24701405, 5.49543667, 4.26142502, 4.08948708, 4.63077211, 3.87147403, 3.94067001, 4.07772207, 3.92586637, 4.08522177, 3.30853844, 3.61829805, 3.7432282, 4.01266813, 4.69895411, 3.87269831, 4.28898907, 4.22624111, 3.32090139, 4.35394907, 3.9292655, 4.49979591, 3.46028185, 3.34274817, 3.65736628, 3.98849535, 3.56773329, 3.72102666, 3.96823812, 3.70147252, 3.35786319, 3.11710215, 4.12349987, 3.44485784, 3.46436262, 3.92651296, 3.95226932, 3.29852152, 3.67052078, 3.28835487, 3.43962932, 3.56970334, 3.56558371, 3.33553839, 3.8460393, 3.20287657, 3.24445295, 3.51491094, 3.1539073, 3.45946574, 3.27563238, 3.24114919, 3.55117273, 3.59264994, 3.10296822, 3.35982275, 3.43497539, 3.31336713, 3.4321816, 3.05763912, 4.11062145, 3.74305773, 3.53349614, 3.20935321, 3.49794126, 3.94020963, 3.30340505, 3.07616091, 3.54284811, 3.15965581, 3.20083356, 3.04315138, 3.24469709, 3.45358896, 3.26487231, 3.09834433, 3.70214319, 3.64543915, 3.16365409, 3.35431671, 3.29424906, 3.43659139, 3.14266443, 3.98939967, 3.45699263, 3.1579864, 3.21501207, 3.20205116, 3.52541614, 3.43071365, 3.45859289, 3.40004301, 3.57617569, 3.42912483, 3.33778572, 3.3046093, 3.17044139, 3.4165206, 3.21712685, 3.46911573, 3.87142229, 3.13837814, 3.35654593, 3.1668973, 3.3797183, 3.2033627, 3.99370837, 3.08212519, 3.56838274, 3.49401617, 3.55878401, 3.5540421, 3.455199, 3.0671401, 3.29419017, 3.23611975, 3.08107328, 3.14654613, 3.31418228, 4.00592852, 3.14651895, 3.13021541, 3.16619492, 3.23518562, 3.12744188, 3.53402448, 3.53708005, 3.30839467, 3.28627777, 3.41007543, 3.33130884, 3.25765657, 3.23594856, 3.34298015, 3.1003356, 3.11151195, 3.57025194, 3.51346064, 3.17783618, 3.00914001, 3.38840246, 3.28476024, 3.25792432, 3.31144667, 3.36555099, 3.20094347, 3.04267788, 3.15228891, 3.23280191, 3.16508889, 3.36322975, 3.17015982, 3.38842893, 3.2413373, 3.20192456, 3.160707, 3.23370862, 3.22860575, 3.4750104, 3.14285827, 3.25596571, 3.48405838, 3.18517303, 3.25276613, 3.0487957, 3.19686127, 3.18815422, 3.1480267]
patch_3c = [11.87641239, 6.11640072, 5.53506756, 5.00430727, 5.32840872, 3.72314715, 7.189363, 4.05625916, 4.53048992, 4.55481195, 5.09064198, 3.88193583, 3.56155896, 3.64938021, 3.71115041, 4.70603323, 4.36217117, 5.45770407, 3.17679596, 4.15937281, 3.58125162, 3.38703537, 4.24503469, 3.83481717, 4.43806744, 3.24099803, 4.13466263, 4.42204714, 3.07100463, 3.53968167, 3.84183121, 3.53494406, 3.22095609, 3.25910878, 2.99100757, 3.16947317, 3.52963305, 3.19347262, 3.66087604, 3.27139974, 3.21546888, 3.15232801, 3.53238225, 3.48311496, 3.37058973, 3.24771428, 3.1089561, 3.24289441, 3.00064421, 3.35416651, 3.99157214, 3.25538373, 3.04753351, 2.97890067, 3.49435759, 2.95312619, 2.92410016, 3.06739163, 3.04927039, 3.12122178, 2.99550104, 3.11563587, 3.24607205, 3.00946569, 3.13248396, 3.39727092, 3.23720789, 2.95614052, 2.78155756, 2.88429189, 3.0804677, 3.43946075, 3.1488471, 3.38364649, 3.10030317, 2.85647964, 2.98681378, 2.93654108, 2.90486026, 2.98070621, 2.99997377, 2.91853666, 3.28471684, 3.14795923, 3.5804317, 2.96690655, 3.01826334, 3.3912003, 3.05202842, 3.22127295, 3.01046777, 2.97845936, 2.8765099, 3.17364383, 3.04679608, 3.04562807, 2.88715506, 3.02575064, 2.90333056, 3.26815844, 3.12113619, 2.97813034, 2.94015646, 3.0285635, 3.19239283, 2.85092688, 3.24364853, 2.91335154, 3.10506654, 2.93176484, 3.03284121, 2.93349791, 2.98167825, 2.97369051, 2.89075351, 2.89438128, 3.16661072, 2.89658785, 2.97094464, 3.40795255, 2.86116862, 3.0571568, 3.01523471, 2.95824313, 2.89505816, 2.90740061, 3.24870372, 2.93613768, 3.43720961, 2.83435607, 2.80467772, 2.85537386, 2.90396953, 2.84565759, 3.13922071, 2.88914227, 2.90037179, 2.85418415, 2.84087563, 3.251297, 2.96338296, 2.90452433, 3.31935763, 2.79737425, 2.80758619, 2.8673315, 2.85970354, 2.82640886, 2.97712517, 2.84629965, 3.28042364, 2.92315483, 2.92180037, 2.94120193, 2.82334852, 3.0238986, 3.29716992, 2.86802268, 2.97957563, 2.93199611, 2.90160441, 3.14138198, 2.89936996, 3.45196652, 2.8512578, 3.05122423, 3.13184309, 2.76024175, 3.07825232, 2.87015533, 2.86104321, 2.8266902, 2.87487078, 2.99857664, 2.81856489, 2.80716181, 2.77482271, 2.90727615, 2.95981264, 2.90060687, 3.15084553, 2.92018747, 2.85076547, 2.93244672, 2.88278699, 3.17873144, 2.87173986, 2.82420683, 2.84403968, 2.84261799, 2.81306696, 2.97473216, 2.78651118, 2.85475993, 2.83588314, 2.92056155, 2.82104039, 2.87309813, 2.87371969, 2.88709259, 2.83279848, 2.91635084, 2.75980687, 2.8135457, 2.97374654, 2.97634888, 2.92060018]
rcaunetc = [8676.288263, 6641.241973, 4680.413811, 3518.245105, 2237.18601, 1414.641832, 880.9317701, 160.2835336, 86.11831355, 63.62168642, 66.18724562, 52.88078509, 71.2763538, 51.58294896, 69.98931954, 70.10709214, 88.60738433, 76.53005865, 50.77673576, 57.69384155, 60.39537038, 55.54759209, 66.42241768, 59.34709746, 56.58018406, 65.21023176, 58.15963505, 58.02108804, 56.46812816, 70.7867537, 58.70439483, 65.76588827, 67.83207986, 66.99558047, 63.95979469, 52.39192823, 66.73218566, 61.60578912, 58.6392424, 73.41407615, 63.99109294, 55.24556798, 58.2253272, 60.79211669, 66.411759, 56.38648276, 69.61868901, 62.44866636, 70.45659345, 73.6932974, 73.70337281, 70.28703969, 67.0179663, 61.42120186, 66.83404569, 72.17482759, 61.08590923, 63.68658121, 58.63896539, 58.07971882, 60.13377342, 62.24088943, 63.16650364, 64.61220116, 61.85932036, 64.79663857, 76.564355, 64.53774092, 77.00327239, 73.30788521, 66.04419895, 65.62402576, 61.12938581, 62.97449675, 66.18833158, 64.23368133, 65.71213373, 70.10182688, 73.61681342, 77.97028833, 63.76128427, 67.97700436, 66.97918711, 65.9183488, 68.47043566, 74.41671354, 68.76754415, 69.48429521, 68.48269064, 72.17058973, ]

r2_spatiotemporal_non_local_patch7c = [13.04343891, 9.40885353, 9.40866566, 7.55513668, 9.10220909, 10.3401947, 6.14245129, 7.55504894, 7.67856598, 6.0458951, 6.92469931, 5.4341712, 7.03937244, 6.22826385, 6.33642387, 6.21039295, 5.45236444, 5.63323116, 5.36432552, 5.66995335, 6.03277969, 5.28289032, 5.42223597, 5.11519527, 5.3006568, 5.19889545, 5.99895239, 5.19372082, 4.88108826, 4.99466085, 5.2905097, 5.68158484, 5.77085352, 5.44954777, 4.80539751, 5.70629644, 4.98905802, 5.6551733, 4.99060917, 4.79177713, 4.75530863, 4.58743572, 5.13088751, 4.96179104, 5.02085114, 5.46617794, 4.78595543, 4.65354729, 4.65843678, 4.41089678, 4.82907391, 4.72789192, 4.65708447, 4.94407177, 4.52999878, 4.45655298, 4.63006639, 4.46361303, 4.81795645, 4.96229506, 4.34279919, 4.2636714, 4.73684502, 4.56131792, 4.57169628, 4.52065182, 4.88579512, 4.51066208, 4.59607267, 4.63534403, 4.55602694, 4.56355762, 4.40625286, 4.42788315, 4.55356073, 4.66247654, 4.76637936, 4.50681353, 4.69086313, 4.3144598, 4.41010952, 4.38990498, 4.25010395, 4.43097162, 4.66179562, 4.74346733, 4.69956589, 4.37960911, 4.43759871, 4.24985313, 4.13600063, 4.41207457, 4.18211365, 4.48667288, 4.46711445, 4.8244381, 4.3547945, 4.36508083, 4.57458973, 4.36238194, 4.77519131, 4.35068607, 4.42667675, 4.33393955, 4.810853, 4.33871746, 4.36200809, 4.22497702, 4.2844696, 4.26111794, 4.39823437, 4.26993275, 4.17793131, 4.21482897, 4.27735567, 4.26779556, 4.28725195, 4.25175667, 4.20641327, 4.33720016, 4.29047871, 4.29630375, 4.28599596, 4.38550282, 4.23809099, 4.22943258, 4.2938242, 4.18076229, 4.35376072, 4.18355083, 4.2624197, 4.33558989, 4.1702795, 4.20326424, 4.21294737, 4.1729722, 4.10695934, 4.25260735, 4.22634125, 4.24640751, 4.29612255, 4.39848089, 4.75549889, 4.32668877, 4.08804893, 4.21757793, 4.23805237, 4.22391605, 4.14529276, 4.1521616, 4.21032667, 4.1724968, 4.23105097, 4.25700903, 4.21428728, 4.17547703, 4.16375589, 4.18548584, 4.28708029, 4.23040009, 4.12399387, 4.19261408, 4.11018133, 4.08690882, 4.26264095, 4.05456781, 4.11319065, 4.1800952, 4.10808325, 4.12412548, 4.46198654, 4.11875105, 4.10951757, 4.1555295, 4.1917119, 4.18154812, 4.29234362, 4.22449255, 4.16879034, 4.1315465, 4.17870998, 4.23286629, 4.25587749, 4.28288555, 4.11759329, 4.23743534, 4.12601566, 4.14992619, 4.24614048, 4.15910387, 4.12670994, 4.24968481, 4.16504765, 4.08498049, 4.1473155, 4.16984272, 4.13242388, 4.15837097, 4.12827253, 4.18770123, 4.07724762, 4.09600735, 4.10857487]
r2_temporal_non_local_patch7 = [8.1405077, 11.3214922, 5.73071527, 6.50741339, 7.86607742, 7.21777821, 5.96040726, 5.74334669, 5.44483566, 5.07830811, 5.06622744, 5.80893087, 4.85242844, 5.10035086, 5.17405224, 7.86214304, 5.67284489, 4.17338848, 5.70334864, 4.51280928, 4.52876759, 4.69755745, 4.72559214, 4.97291231, 4.29271269, 4.26297569, 4.54167271, 4.23775768, 3.9884994, 4.81511593, 5.12022066, 4.56394768, 4.0877924, 4.66841269, 4.60406923, 3.91459799, 3.74024963, 3.93812871, 4.329175, 4.89497185, 4.11111307, 4.68842554, 4.16169262, 5.85053587, 3.91467714, 3.77678728, 4.20616007, 4.28979778, 4.10604763, 3.95496225, 3.90691829, 4.1728735, 4.53711033, 4.13448095, 3.85454798, 3.68391919, 3.69969296, 3.87423968, 4.37592936, 4.59744835, 3.71127367, 3.74719167, 3.7596302, 3.82008672, 3.86855507, 3.74428415, 3.75656581, 3.753299, 3.92097402, 3.6419239, 3.90358806, 4.19512129, 3.83832097, 3.89585185, 3.78773999, 3.81505013, 3.63462114, 3.90715289, 4.03879929, 4.121768, 4.07810211, 4.12334061, 3.90179396, 3.71766782, 3.74953461, 3.67888498, 3.79345322, 3.64870715, 3.79931521, 3.79225111, 3.66253734, 3.8222301, 3.79314423, 3.73071337, 3.60048366, 3.70575905, 3.81182599, 3.63074446, 3.7337203, 3.80960846, 3.69703865, 3.94738817, 3.63827181, 3.71371222, 3.77711987, 3.64590383, 3.75550771, 3.64886093, 3.64718699, 3.7566402, 3.5647819, 3.83519697, 3.66555285, 3.61402822, 3.72047114, 3.74744749, 3.59096146, 3.82572746, 3.62498355, 3.66987157, 3.55864334, 3.78972387, 3.77412224, 3.53007841, 3.65478897, 3.7261188]
r2_noattention_patch7 = [13.49791241, 12.70451927, 9.70730877, 7.82528448, 7.21984768, 6.68675756, 7.58714771, 6.42951727, 6.23313665, 7.13084316, 6.83296824, 7.7961998, 5.7708087, 5.73978806, 5.3294239, 6.69772053, 5.76981449, 6.02048111, 5.16659451, 5.58581734, 5.62757206, 5.50103807, 4.96205807, 4.99210596, 5.18364239, 4.97561789, 5.00708103, 5.25183964, 4.68185139, 4.94998646, 4.93635559, 5.01198673, 4.69010258, 4.79919529, 4.63270235, 4.75362015, 4.65334034, 4.95782375, 4.72297955, 4.48593616, 4.63086796, 4.58643579, 4.76058531, 4.60705805, 4.76782131, 4.42510223, 4.53249168, 4.5884304, 4.30249882, 4.43803883, 4.49883366, 4.56711864, 4.33348179, 4.50853109, 4.50866175, 4.40367794, 4.3773551, 4.39002132, 4.28950119, 4.40319633, 4.24112749, 4.24555731, 4.28629684, 4.2137022, 4.42148733, 4.12755203, 4.23936939, 4.16309547, 4.37089348, 4.23714113, 4.09699249, 4.26964378, 4.1888442, 4.33776951, 4.17818022, 4.26609612, 4.23522282, 4.11179781, 4.40053558, 4.19494677, 4.1596961, 4.05855989, 4.08714199, 4.06554556, 4.22806454, 4.2614603, 4.12848663, 4.37995625, 4.04625607, 4.1074338, 4.25394201, 4.14616871, 3.98404503, 4.07521057, 4.0010891, 4.06563091, 4.16287231, 3.97669983, 4.10049343, 4.00227833, 4.03509092, 3.9985013, 4.0308919, 4.09587097, 3.99562526, 3.99566031, 3.9839561, 3.97775507, 4.02482319, 4.01066208, 4.053123, 4.05223179, 4.06060314, 4.08824015, 4.19079542, 3.98091936, 3.98888016, 4.05777121, 3.96476221, 3.98117018, 3.99522352, 3.97311211, 3.95975494, 4.07594252, 3.9875946, 3.97461748, 4.02994823, 4.07291698, 3.93603134, 3.98656702, 3.96312261, 3.94588327]

patch3_spatiotemporal_r2 = [14.03615093, 10.03844547, 15.12466431, 8.43647766, 11.82411575, 6.97490549, 5.59299755, 8.57108307, 7.74495554, 5.17020702, 6.67562389, 14.59071922, 5.24812841, 5.36636829, 6.22488165, 5.7031951, 5.97996759, 4.99882507, 4.39633465, 7.7282486, 4.90553856, 4.4317522, 4.66786098, 4.45795345, 5.46380186, 5.00873184, 4.71918344, 5.50227833, 4.64212418, 4.14770222, 4.11677837, 7.27416086, 7.13544226, 6.75380325, 7.05038595, 6.23163176, 4.99302959, 4.07174397, 4.25989103, 4.56787062, 4.2476263, 4.5545969, 4.04473019, 4.12111759, 4.11639404, 3.97566676, 4.17823553, 4.46931362, 3.9685986, 3.94309187, 3.75437689, 4.40232801, 5.04990864, 3.89817667, 3.86510229, 3.78303027, 4.44535494, 3.97105026, 3.90151858, 3.78562284, 4.00226974, 3.85841441, 4.12977457, 4.1147666, 4.10911608, 3.91346622, 3.88859558, 5.64904261, 3.95017743, 4.03280926, 3.81992865, 4.02904797, 4.87846136, 4.13096714, 3.78195643, 3.90314436, 4.78050709, 3.80465627, 3.64405441, 3.9523921, 3.71484995, 3.76116681, 3.78216314, 3.96192884, 3.78056765, 3.73137522, 3.58546448, 4.15474033, 4.27579451, 4.30337095, 3.67250299, 3.66760325, 3.77582884, 3.77258682, 3.81489372, 3.75232768, 3.67358255, 3.64989138, 3.63518906, 4.71576405, 3.82603574, 3.6916554, 3.76856089, 3.93543172, 3.68633389, 3.85599566, 3.8928113, 4.43093872, 3.66732931, 3.71540904, 3.62401438, 3.65877461, 3.92435718, 3.6677773, 3.8733623, 3.87035227, 4.07007074, 3.61535883, 3.60078955, 3.62700224, 3.58581495, 3.60157537, 3.55256152, 3.62242365, 3.65916014, 3.59459352, 3.62037206, 3.56477094, 3.62984514, 3.58487439, 3.66657901, 3.58117151, 3.55812716, 3.71360636, 3.5783577, 3.57163572, 3.62731791, 3.57255483, 3.71913481, 3.54798889, 3.62726355, 3.56700444, 3.57281494, 3.63121557, 3.58762121, 3.55521631, 3.59798884, 3.60372496, 3.58883524, 3.55152702, 3.56236696, 3.53455663, 3.76660109, 3.61854243, 3.56428337, 3.6431694]
patch3_noattention_r2 = [9.31862736, 19.96219254, 8.06696892, 7.577878, 6.39549828, 9.46797371, 5.17631197, 4.67718983, 5.00912762, 5.11744976, 5.15510464, 4.568923, 5.06060171, 6.2070961, 5.07579517, 4.50264978, 4.43581629, 4.93640804, 4.54438639, 4.68596506, 4.3196516, 4.79158735, 4.80787373, 4.3580904, 4.38422346, 6.28191662, 4.56697369, 4.49320412, 4.68483543, 4.48814726, 3.95718837, 5.37300587, 4.57683754, 4.33626652, 4.44816017, 4.627244, 3.76730657, 4.15082836, 3.90470457, 3.85272217, 4.06040859, 4.13954926, 3.84485316, 3.9706738, 4.37120056, 3.93051195, 4.16133118, 4.32962036, 4.05783081, 4.24687958, 3.71611595, 4.16553354, 3.80981207, 4.20323229, 4.00821304, 3.82934451, 4.53243208, 3.62699842, 3.8813076, 4.06898785, 3.83691931, 3.689363, 3.84828258, 3.70107651, 3.73254204, 3.69060588, 4.23543596, 3.64269495, 3.68258524, 4.20213938, 3.8077836, 3.64431, 3.6210084, 3.74621511, 3.68406987, 3.6155808, 3.81209683, 4.08155298, 3.63281679, 3.9105804, 3.63162994, 3.75531268, 3.59235311, 3.67019582, 3.71757436, 3.60108757, 3.65072107, 3.74760747, 3.71272898, 3.54353714, 3.58748746, 3.68178892, 3.62504506, 4.13483667, 4.36556196, 3.51357985, 3.63418889, 3.51008272, 3.67501402, 3.60201907, 3.70090103, 3.84853625, 3.55321765, 3.87709761, 3.57908893, 3.60753179, 3.89099503, 3.53144765, 3.55790663, 3.5172627, 3.52839398, 3.51752234, 3.55887914, 3.67687178, 3.49927092, 3.63943052, 3.61624956, 3.60755157, 3.5574379, 3.48953056, 3.5152564, 3.56951714, 3.48172712, 3.59425616, 3.72293472, 3.55379248, 3.60251164, 3.50222588, 3.68073535, 3.56994128, 3.51954913, 3.47990656, 3.46706533, 3.5632596, 3.67665172, 3.51050997, 3.47340703, 3.73106074, 3.4731853, 3.48942828, 3.56639814, 3.52844739, 3.47849417, 3.49051094, 3.64407277, 3.53479576, 3.53724718, 3.52056551, 3.46857214, 3.4877553, 3.46341372, 3.48923159, 3.50714731, 3.61507225, 3.49590111, 3.46160245, 3.4493413, 3.59203339, 3.43972826, 3.50046611, 3.44948149, 3.4686141, 3.44871259, 3.45781469, 3.513659, 3.49609184, 3.46263051, 3.46865702, 3.54055476, 3.66069794, 3.44921446, 3.46732855, 3.4871974, 3.46668744]

experiment_name = patch3_noattention_r2
patience = 15


def find_stop_epoch(experiment):
    lowest_error = experiment[0]
    lowest_epoch = 0
    no_imp = 0

    for epoch, metric in enumerate(experiment):
        if metric < lowest_error:
            lowest_error = metric
            lowest_epoch = epoch
            no_imp = 0

        if no_imp > patience:
            return lowest_epoch + 1, lowest_error

        no_imp += 1

    raise ValueError("No chance to stop")


e, i = find_stop_epoch(experiment_name)

print(f"Patience: {patience}, Epoch: {e}, Error: {i}")